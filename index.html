<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="shortcut icon" type="image/ico" href="favicon.ico" />
  <title>运维管理</title>
  <link rel="stylesheet" href="../static/js/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../static/js/controls/slick.pager.css" type="text/css"/>
  <link rel="stylesheet" href="../static/js/css/smoothness/jquery-ui.css" type="text/css"/>
 <link rel="stylesheet" href="../static/js/slick-default-theme.css" type="text/css"/>
  <link rel="stylesheet" href="../static/js/examples.css" type="text/css"/>
  <link rel="stylesheet" href="../static/js/controls/slick.columnpicker.css" type="text/css"/>

<script src="../static/js/lib/jquery-1.12.4.min.js"></script>
<script src="../static/js/lib/jquery-ui.min.js"></script>
<script src="../static/js/lib/jquery.event.drag-2.3.0.js"></script>

<script src="../static/js/slick.core.js"></script>
<script src="../static/js/slick.formatters.js"></script>
<script src="../static/js/slick.editors.js"></script>
<script src="../static/js/plugins/slick.rowselectionmodel.js"></script>
<script src="../static/js/plugins/slick.checkboxselectcolumn.js"></script>
<script src="../static/js/slick.grid.js"></script>
<script src="../static/js/slick.dataview.js"></script>
<script src="../static/js/controls/slick.pager.js"></script>
<script src="../static/js/controls/slick.columnpicker.js"></script>
<script src="../static/js/device.manager.js"></script>
  <style>
    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }

	.slick-cell-checkboxsel {
      background: #f0f0f0;
      border-right-color: silver;
      border-right-style: solid;
    }
	
    .cell-selection {
      border-right-color: silver;
      border-right-style: solid;
      background: #f5f5f5;
      color: gray;
      text-align: right;
      font-size: 10px;
    }

    .slick-row.selected .cell-selection {
      background-color: transparent; /* show default selected row background */
    }
  </style>
</head>
<body id="index_body">
<div id="content_div_tenant" stype="width:1320px;heigth:800px;background:rgba(242, 243, 247, 1);margin:0 auto;">
<div style="width:1300px;height:50px;background:linear-gradient(90deg, rgba(30, 50, 77, 1) 0%, rgba(30, 50, 77, 1) 0%, rgba(29, 77, 126, 1) 100%, rgba(29, 77, 126, 1) 100%);margin:0 auto">
  <span style="font-weight:400;font-style:normal;color:#FFFFFF;line-height:28px;font-size:18px;position:absolute;margin-top:10px;margin-left:15px;">酒店安全防护系统</span>
</div>
<div style="width:300px;height:750px;top:50px;background-color：red;margin-left:-650px;left:50%;position:absolute;">
  <div style="width:300px;height:44px;background-color:rgba(242, 242, 242, 1);margin-top:15px;">
    <button value="租户概览" style="position:absolute;width:80px;height:30px;background-color:white;margin-top:8px;margin-left:10px;border:none;">租户概览</button>
  </div>
  <div style="position:absolute;width:300px;height:200px;">
    <table>
	  <tr><td>租户总数：</td><td>100</td></tr>
	  <tr><td>新增租户：</td><td>2</td></tr>
	</table>
  </div>
  <div style="position:absolute;width:300px;height:44px;background-color:rgba(242, 242, 242, 1);margin-top:264px;">
    <button value="资产概览" style="position:absolute;width:80px;height:30px;background-color:white;margin-top:8px;margin-left:10px;border:none;">资产概览</button>
  </div>
  <div style="position:absolute;300px;height:200px;margin-top:310px;">
    <table>
	  <tr><td>异常资产总数：</td><td>34</td></tr>
	  <tr><td>新增异常资产：</td><td>1</td></tr>
	</table>
  </div>
</div>
<div style="position:absolute;width:990px;height:750px;top:50px;margin-right:-660px;right:50%;position:absolute;">
  <div style="position:absolute;width:99%;height:44px;background-color:rgba(242, 242, 242, 1);margin-top:15px;">
    <button value="租户管理" style="position:absolute;width:80px;height:30px;background-color:white;margin-top:8px;margin-left:10px;border:none;">租户管理</button>
  </div>
  <div id="batch_operation" style="position:absolute;width:99%;height:130px;background-color:rgba(242, 242, 242, 1);margin-top:60px;">
    <table>
	  <tr><td>租户名称:</td><td><input id ="tenant_name" name="name"/></td><td style="width:30px;"></td><td>租户地址:</td><td><input id="tenant_address" name="address"/></td><td style="width:30px;"></td><td>租户电话:</td><td><input id="tel" name="tel" value=""/></tr>
	  <tr><td>联系人:</td><td><input id="contact_person" name="contact_person"/></td><td style="width:30px;"></td><td>联系人电话:</td><td><input id="phone" name="phone"/></td><td style="width:30px;"></td><td></td><td><input value="创建租户" type="button" onclick="addTenant();"/></td></tr>
	</table>
  </div>
  <div style="width:99%;height:580px;margin-top:200px;position:absolute;">
    <div id="myGrid" style="width:100%;height:540px;"></div>
    <div id="pager" style="width:100%;height:20px;"></div>
</div>
</div>
</div>

<div id="content_device_div" stype="width:1320px;heigth:800px;background:rgba(242, 243, 247, 1);margin:0 auto;display:none;">
<div style="width:1300px;height:50px;background:linear-gradient(90deg, rgba(30, 50, 77, 1) 0%, rgba(30, 50, 77, 1) 0%, rgba(29, 77, 126, 1) 100%, rgba(29, 77, 126, 1) 100%);margin:0 auto">
  <span style="font-weight:400;font-style:normal;color:#FFFFFF;line-height:28px;font-size:18px;position:absolute;margin-top:10px;margin-left:15px;">酒店安全防护系统</span>
</div>
<div style="width:300px;height:750px;top:50px;background-color：red;margin-left:-650px;left:50%;position:absolute;">
  <div style="width:300px;height:44px;background-color:rgba(242, 242, 242, 1);margin-top:15px;">
    <button value="租户概览" style="position:absolute;width:80px;height:30px;background-color:white;margin-top:8px;margin-left:10px;border:none;">租户信息</button>
  </div>
  <div style="position:absolute;width:300px;height:200px;">
    <table>
	  <tr><td>租户id：</td><td>d7856b5f-ad2a-4e60-b1db-e5de5b57e606</td></tr>
	  <tr><td>租户名字：</td><td>1</td></tr>
      <tr><td>资产总数：</td><td>100</td></tr>
      <tr><td>异常资产数：</td><td>1</td></tr>
	</table>
  </div>
</div>
<div style="position:absolute;width:990px;height:750px;top:50px;margin-right:-660px;right:50%;position:absolute;">
  <div style="position:absolute;width:99%;height:44px;background-color:rgba(242, 242, 242, 1);margin-top:15px;">
    <button value="租户管理" style="position:absolute;width:80px;height:30px;background-color:white;margin-top:8px;margin-left:10px;border:none;">资产录入</button>
  </div>
  <div id="batch_operation" style="position:absolute;width:99%;height:130px;background-color:rgba(242, 242, 242, 1);margin-top:60px;">
    <table>
	  <tr><td>管辖区域:</td><td><input id ="room_num" name="room_num"/></td><td style="width:30px;"></td><td>终端mac:</td><td><input id="mac" name="mac"/></td><td style="width:30px;"></td><td>终端版本:</td><td><input id="version" name="version" value=""/></tr>
	  <tr><td>指纹库版本:</td><td><input id="finger_version" name="finger_version"/></td><td style="width:30px;"></td><td>连接wifi:</td><td><input id="wifi" name="wifi"/></td><td style="width:30px;"></td><td></td><td><input value="创建" type="button" onclick="addRoom();"/></td></tr>
	</table>
  </div>
  <div style="width:99%;height:580px;margin-top:200px;position:absolute;">
    <div id="device_list" style="width:100%;height:540px;"></div>
    <div id="device_pager" style="width:100%;height:20px;"></div>
  </div>
</div>
</div>

<script>
$("#content_device_div")[0].style.display = "none";
function addTenant(){
	var tenant_name = $("#tenant_name").val();
	var tenant_address = $(" #tenant_address ").val();
	var tel = $(" #tel ").val();
	var contact_person = $(" #contact_person ").val();
	var phone = $(" #phone ").val();
	var paramers = {
		tenant_name: tenant_name,
		tenant_address: tenant_address,
		tel: tel,
		contact_person: contact_person,
		phone: phone
	};
	$.ajax({
      type: "POST",
      url: "/add_tenant",
      data: JSON.stringify(paramers),
      contentType: "application/json",
      dataType : "json",
      success: function(data) {
         listTenant();
      }
   });

}

function listTenant(){
	$.ajax({
      type: "GET",
      url: "/list_tenant",
      contentType: "application/json",
      dataType : "json",
      success: function(data) {
dataView.beginUpdate();
  dataView.setItems(data);

  dataView.endUpdate();
      }
   });
}

function showDetail(){
	alert(77);
	$("#content_div_tenant")[0].style.display = "none";
	$("#content_device_div")[0].style.display = "";
}

function isIEPreVer9() { var v = navigator.appVersion.match(/MSIE ([\d.]+)/i); return (v ? v[1] < 9 : false); }

var dataView;
var grid;
var data = [];
var columns =[] ;

columns = [
  {id: "id", name: "租户ID", field: "id",width: 130,  minWidth: 100, cssClass: "cell-title", sortable: true},
  {id: "tenant_name", name: "租户名称", field: "tenant_name",width: 130,  minWidth: 100, cssClass: "cell-title", sortable: true},
  {id: "tenant_addr", name: "租户地址", field: "tenant_addr",width: 130, minWidth: 100,  sortable: true},
  {id: "tenant_phone", name: "租户电话", field: "tenant_phone", width: 120, minWidth: 100, cssClass: "cell-title",  sortable: true},
  {id: "call_by", name: "联系人", field: "call_by",width: 120, minWidth: 100, cssClass: "cell-title", sortable: true},
  {id: "phone", name: "联系人手机", field: "phone", width: 120,  minWidth: 100, cssClass: "cell-title", sortable: true},
  {id: "abnormal", name: "异常资产数", field: "abnormal",width: 110,  minWidth: 100, cssClass: "cell-title", sortable: true},
  {id: "operation_clo", name: "操作", width: 120, maxWidth: 140, cssClass: "cell-effort-driven", field: "effortDriven", formatter: buttonFormatter}
];

var options = {
  columnPicker: {
    columnTitle: "Columns",
    hideForceFitButton: false,
    hideSyncResizeButton: false,
    forceFitTitle: "Force fit columns",
    syncResizeTitle: "Synchronous resize",
  },
  editable: true,
  enableAddRow: true,
  enableCellNavigation: true,
  asyncEditorLoading: true,
  forceFitColumns: false,
  topPanelHeight: 25
};

function buttonFormatter(row,cell,value,columnDef,dataContext){  
    var button = "<input class='del' type='button' id='del_button' value='删除' title='删除'/><input class='del' style='margin-left:5px;' type='button' id='detail_button' value='详情' title='详情'/>";
    //the id is so that you can identify the row when the particular button is clicked
    return button;
    //Now the row will display your button
}

var sortcol = "title";
var sortdir = 1;
var percentCompleteThreshold = 0;
var searchString = "";

function requiredFieldValidator(value) {
  if (value == null || value == undefined || !value.length) {
    return {valid: false, msg: "This is a required field"};
  }
  else {
    return {valid: true, msg: null};
  }
}

function myFilter(item, args) {
  if (item["percentComplete"] < args.percentCompleteThreshold) {
    return false;
  }

  if (args.searchString != "" && item["title"].indexOf(args.searchString) == -1) {
    return false;
  }

  return true;
}

function percentCompleteSort(a, b) {
  return a["percentComplete"] - b["percentComplete"];
}

function comparer(a, b) {
  var x = a[sortcol], y = b[sortcol];
  return (x == y ? 0 : (x > y ? 1 : -1));
}

function toggleFilterRow() {
  grid.setTopPanelVisibility(!grid.getOptions().showTopPanel);
}


$(".grid-header .ui-icon")
        .addClass("ui-state-default ui-corner-all")
        .mouseover(function (e) {
          $(e.target).addClass("ui-state-hover")
        })
        .mouseout(function (e) {
          $(e.target).removeClass("ui-state-hover")
        });

$(function () {
  dataView = new Slick.Data.DataView({ inlineFilters: true });
  grid = new Slick.Grid("#myGrid", dataView, columns, options);
  grid.setSelectionModel(new Slick.RowSelectionModel());
  
  var pager = new Slick.Controls.Pager(dataView, grid, $("#pager"));
  var columnpicker = new Slick.Controls.ColumnPicker(columns, grid, options);


  // move the filter panel defined in a hidden div into grid top panel
  $("#inlineFilterPanel")
      .appendTo(grid.getTopPanel())
      .show();

  grid.onCellChange.subscribe(function (e, args) {
    dataView.updateItem(args.item.id, args.item);
  });

  grid.onAddNewRow.subscribe(function (e, args) {
    var item = {"num": data.length, "id": "new_" + (Math.round(Math.random() * 10000)), "title": "New task", "duration": "1 day", "percentComplete": 0, "start": "01/01/2009", "finish": "01/01/2009", "effortDriven": false};
    $.extend(item, args.item);
    dataView.addItem(item);
  });

  grid.onKeyDown.subscribe(function (e) {
    // select all rows on ctrl-a
    if (e.which != 65 || !e.ctrlKey) {
      return false;
    }

    var rows = [];
    for (var i = 0; i < dataView.getLength(); i++) {
      rows.push(i);
    }

    grid.setSelectedRows(rows);
    e.preventDefault();
  });
  
  grid.onSort.subscribe(function (e, args) {
    sortdir = args.sortAsc ? 1 : -1;
    sortcol = args.sortCol.field;

    if (isIEPreVer9()) {
      // using temporary Object.prototype.toString override
      // more limited and does lexicographic sort only by default, but can be much faster

      var percentCompleteValueFn = function () {
        var val = this["percentComplete"];
        if (val < 10) {
          return "00" + val;
        } else if (val < 100) {
          return "0" + val;
        } else {
          return val;
        }
      };

      // use numeric sort of % and lexicographic for everything else
      dataView.fastSort((sortcol == "percentComplete") ? percentCompleteValueFn : sortcol, args.sortAsc);
    } else {
      // using native sort with comparer
      // preferred method but can be very slow in IE with huge datasets
      dataView.sort(comparer, args.sortAsc);
    }
  });

  // wire up model events to drive the grid
  // !! both dataView.onRowCountChanged and dataView.onRowsChanged MUST be wired to correctly update the grid
  // see Issue#91
  dataView.onRowCountChanged.subscribe(function (e, args) {
    grid.updateRowCount();
    grid.render();
  });

  dataView.onRowsChanged.subscribe(function (e, args) {
    grid.invalidateRows(args.rows);
    grid.render();
  });

 grid.onSelectedRowsChanged.subscribe(function (e, args) {
        // debugging to see the active row in response to questions
        // active row has no correlation to the selected rows
        // it will remain null until a row is clicked and made active
        // selecting and deselecting rows via checkboxes will not change the active row
        var rtn = args.grid.getActiveCell();
        var x = args.rows;
    });
  
  dataView.onPagingInfoChanged.subscribe(function (e, pagingInfo) {
    grid.updatePagingStatusFromView( pagingInfo );

    // show the pagingInfo but remove the dataView from the object, just for the Cypress E2E test
    delete pagingInfo.dataView;
    console.log('on After Paging Info Changed - New Paging:: ', pagingInfo);
  });

  dataView.onBeforePagingInfoChanged.subscribe(function (e, previousPagingInfo) {
    // show the previous pagingInfo but remove the dataView from the object, just for the Cypress E2E test
    delete previousPagingInfo.dataView;
    console.log('on Before Paging Info Changed - Previous Paging:: ', previousPagingInfo);
  });

  var h_runfilters = null;

  // wire up the slider to apply the filter to the model
  $("#pcSlider,#pcSlider2").slider({
    "range": "min",
    "slide": function (event, ui) {
      Slick.GlobalEditorLock.cancelCurrentEdit();

      if (percentCompleteThreshold != ui.value) {
        window.clearTimeout(h_runfilters);
        h_runfilters = window.setTimeout(updateFilter, 10);
        percentCompleteThreshold = ui.value;
      }
    }
  });


  // wire up the search textbox to apply the filter to the model
  $("#txtSearch,#txtSearch2").keyup(function (e) {
    Slick.GlobalEditorLock.cancelCurrentEdit();

    // clear on Esc
    if (e.which == 27) {
      this.value = "";
    }

    searchString = this.value;
    updateFilter();
  });

  function updateFilter() {
    dataView.setFilterArgs({
      percentCompleteThreshold: percentCompleteThreshold,
      searchString: searchString
    });
    dataView.refresh();
  }

  grid.onClick.subscribe(function (e) {
      var cell = grid.getCellFromEvent(e);
      if (grid.getColumns()[cell.cell].id == "operation_clo") {
        if(e.target.id == "detail_button"){
	        showDetail();
        }
        if(e.target.id == "del_button"){
	        alert("delete tenant");
        }
      }
    });

  // initialize the model after all the events have been hooked up
  dataView.beginUpdate();
  dataView.setItems(data);
  dataView.setFilterArgs({
    percentCompleteThreshold: percentCompleteThreshold,
    searchString: searchString
  });
  dataView.setFilter(myFilter);
  dataView.endUpdate();

  // if you don't want the items that are not visible (due to being filtered out
  // or being on a different page) to stay selected, pass 'false' to the second arg
  dataView.syncGridSelection(grid, true);
  $("#gridContainer").resizable();
  listTenant();
})
</script>
</body>
</html>